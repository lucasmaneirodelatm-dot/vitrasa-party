<!doctype html>
<html lang="es" class="h-full">
 <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Party Vitrasa Tablero</title>
  <script src="https://cdn.tailwindcss.com/3.4.17"></script>
  <script src="/_sdk/element_sdk.js"></script>
  <link href="https://fonts.googleapis.com/css2?family=Fredoka:wght@400;500;600;700&amp;family=Nunito:wght@400;600;700&amp;display=swap" rel="stylesheet">
  <style>
    * { font-family: 'Nunito', sans-serif; }
    .title-font { font-family: 'Fredoka', sans-serif; }
    @keyframes diceToss { 0%, 100% { transform: rotateX(0) rotateY(0) rotateZ(0); } 25% { transform: rotateX(180deg) rotateY(180deg) rotateZ(90deg); } 50% { transform: rotateX(360deg) rotateY(360deg) rotateZ(180deg); } 75% { transform: rotateX(540deg) rotateY(180deg) rotateZ(270deg); } }
    @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.5; } }
    @keyframes shake { 0%, 100% { transform: translateX(0); } 25% { transform: translateX(-5px); } 75% { transform: translateX(5px); } }
    .dice-rolling { animation: diceToss 0.6s ease-out; }
    .pulse-anim { animation: pulse 1s ease-in-out infinite; }
    .shake-anim { animation: shake 0.3s ease-in-out; }
    .board-square { width: 40px; height: 40px; display: flex; align-items: center; justify-content: center; border-radius: 4px; font-size: 11px; font-weight: bold; border: 1px solid rgba(0,0,0,0.1); }
    .challenge-item { transition: all 0.2s; cursor: pointer; }
    .challenge-item:active { transform: scale(0.95); }
    .memory-card { width: 60px; height: 60px; perspective: 1000px; cursor: pointer; }
    .memory-card-inner { position: relative; width: 100%; height: 100%; transition: transform 0.6s; transform-style: preserve-3d; }
    .memory-card.flipped .memory-card-inner { transform: rotateY(180deg); }
    .memory-card-front, .memory-card-back { position: absolute; width: 100%; height: 100%; backface-visibility: hidden; display: flex; align-items: center; justify-content: center; border-radius: 8px; font-weight: bold; }
    .memory-card-front { background: linear-gradient(135deg, #3b82f6, #1e40af); color: white; font-size: 24px; }
    .memory-card-back { background: #e5e7eb; transform: rotateY(180deg); }
  </style>
  <style>body { box-sizing: border-box; }</style>
  <script src="/_sdk/data_sdk.js" type="text/javascript"></script>
 </head>
 <body class="h-full">
  <div id="app-wrapper" class="h-full w-full overflow-auto bg-gradient-to-br from-emerald-600 via-green-500 to-teal-600"><!-- Pantalla de Configuraci√≥n -->
   <div id="config-screen" class="min-h-full flex flex-col items-center justify-center p-4">
    <div class="text-center mb-6">
     <h1 class="title-font text-5xl font-bold text-white drop-shadow-lg mb-2">Party Vitrasa</h1>
     <p class="text-white/90 text-lg">üé≤ Tablero Interactivo üöå</p>
    </div>
    <div class="bg-white/95 backdrop-blur rounded-3xl p-6 shadow-2xl max-w-md w-full">
     <h2 class="title-font text-2xl font-bold text-emerald-700 mb-4 text-center">Configuraci√≥n</h2><!-- Tipo de Juego -->
     <div class="mb-6"><label class="text-sm font-semibold text-gray-700 block mb-3">¬øC√≥mo jug√°is?</label>
      <div class="space-y-2"><button onclick="selectGameMode('individual')" id="btn-individual" class="w-full p-3 border-2 border-emerald-500 bg-emerald-50 rounded-lg text-emerald-700 font-bold transition-all"> üë§ Individual (1-4 jugadores) </button> <button onclick="selectGameMode('teams')" id="btn-teams" class="w-full p-3 border-2 border-gray-300 bg-white rounded-lg text-gray-700 font-bold transition-all hover:border-emerald-500"> üë• Equipos (2 o 4) </button>
      </div>
     </div><!-- N√∫mero de Jugadores/Equipos -->
     <div class="mb-6"><label class="text-sm font-semibold text-gray-700 block mb-3">¬øCu√°ntos?</label>
      <div id="player-count-buttons" class="grid grid-cols-2 gap-2"><button onclick="selectPlayerCount(2)" class="p-2 bg-emerald-100 border border-emerald-300 rounded-lg font-bold text-emerald-700 hover:bg-emerald-200">2</button> <button onclick="selectPlayerCount(3)" class="p-2 bg-gray-100 border border-gray-300 rounded-lg font-bold text-gray-700 hover:bg-gray-200">3</button> <button onclick="selectPlayerCount(4)" class="p-2 bg-gray-100 border border-gray-300 rounded-lg font-bold text-gray-700 hover:bg-gray-200">4</button>
      </div>
     </div><!-- Nombres de Jugadores -->
     <div class="mb-6 max-h-48 overflow-y-auto"><label class="text-sm font-semibold text-gray-700 block mb-2">Nombres</label>
      <div id="players-input" class="space-y-2"><input type="text" id="player-name-1" placeholder="Jugador 1" class="w-full p-2 border border-gray-300 rounded-lg text-sm"> <input type="text" id="player-name-2" placeholder="Jugador 2" class="w-full p-2 border border-gray-300 rounded-lg text-sm">
      </div>
     </div><button onclick="startGame()" class="w-full bg-gradient-to-r from-emerald-500 to-green-600 text-white font-bold text-lg py-3 rounded-xl hover:from-emerald-600 hover:to-green-700 transition-all"> üéÆ ¬°Jugar! </button>
    </div>
   </div><!-- Pantalla de Juego -->
   <div id="game-screen" class="hidden min-h-full p-3 md:p-4">
    <div class="max-w-4xl mx-auto"><!-- Turno actual -->
     <div class="bg-white/95 backdrop-blur rounded-2xl p-4 mb-4 shadow-xl">
      <div class="flex items-center justify-between">
       <div>
        <p class="text-xs md:text-sm text-gray-600">Turno de:</p>
        <div class="title-font text-lg md:text-2xl font-bold text-emerald-700 flex items-center gap-2"><span id="player-color" class="w-5 h-5 rounded-full"></span> <span id="player-name-display" class="truncate">Jugador</span>
        </div>
       </div>
       <div class="text-right">
        <p class="text-xs md:text-sm text-gray-600">Puntos:</p>
        <p id="player-score-display" class="title-font text-2xl md:text-3xl font-bold text-emerald-600">0</p>
       </div>
      </div>
     </div><!-- Dados -->
     <div class="bg-white/95 backdrop-blur rounded-2xl p-4 mb-4 shadow-xl">
      <div class="flex items-center justify-center gap-4">
       <div id="dice-1" class="w-14 h-14 md:w-16 md:h-16 bg-white border-4 border-emerald-500 rounded-lg flex items-center justify-center text-3xl md:text-4xl font-bold shadow-lg">
        üé≤
       </div>
       <div id="dice-2" class="w-14 h-14 md:w-16 md:h-16 bg-white border-4 border-emerald-500 rounded-lg flex items-center justify-center text-3xl md:text-4xl font-bold shadow-lg">
        üé≤
       </div><button onclick="rollDice()" id="roll-btn" class="bg-gradient-to-r from-emerald-500 to-green-600 text-white font-bold py-3 px-6 rounded-xl hover:from-emerald-600 hover:to-green-700 transition-all text-base md:text-lg"> üé≤ Tirar </button>
      </div>
      <p id="dice-sum" class="title-font text-2xl md:text-3xl font-bold text-emerald-700 text-center mt-3">Suma: --</p>
     </div><!-- √Årea de Prueba -->
     <div id="challenge-area" class="hidden bg-white/95 backdrop-blur rounded-2xl p-4 mb-4 shadow-2xl">
      <h2 class="title-font text-2xl font-bold text-emerald-700 mb-4 text-center">Prueba üéØ</h2>
      <div id="challenge-content"></div>
     </div><!-- Panel de Jugadores -->
     <div class="bg-white/95 backdrop-blur rounded-2xl p-4 shadow-2xl">
      <h3 class="title-font text-lg font-bold text-emerald-700 mb-3">Clasificaci√≥n</h3>
      <div id="players-panel" class="space-y-2">
      </div>
     </div>
    </div>
   </div><!-- Pantalla de Victoria -->
   <div id="victory-screen" class="hidden min-h-full flex flex-col items-center justify-center p-4">
    <div class="text-center">
     <div class="text-8xl mb-6">
      üèÜ
     </div>
     <h1 class="title-font text-5xl font-bold text-white drop-shadow-lg mb-4">¬°Victoria!</h1>
     <div class="bg-white/20 backdrop-blur rounded-2xl p-6 mb-8 inline-block">
      <p id="winner-name" class="text-4xl font-bold text-yellow-300 mb-2">Ganador</p>
      <p id="winner-score" class="text-2xl text-white">Puntos: 30</p>
     </div><button onclick="backToConfig()" class="bg-white text-emerald-600 font-bold text-xl py-3 px-8 rounded-2xl hover:bg-emerald-50 transition-colors shadow-lg"> üîÑ Nuevo Juego </button>
    </div>
   </div>
  </div>
  <script>
    const defaultConfig = {
      game_title: 'Party Vitrasa',
      winning_score: '15',
      primary_color: '#059669',
      secondary_color: '#FFFFFF',
      text_color: '#1f2937',
      accent_color: '#f59e0b',
      button_color: '#10b981',
      font_family: 'Nunito',
      font_size: 16
    };

    let config = { ...defaultConfig };

    const playerColors = ['#ef4444', '#3b82f6', '#10b981', '#f59e0b', '#8b5cf6', '#ec4899'];

    let gameState = {
      gameMode: 'individual',
      players: [],
      currentPlayerIndex: 0,
      winsScore: 15,
      diceResult: [0, 0],
      isRolling: false,
      hasRolled: false,
      challengeActive: false
    };

    // PRUEBAS INTERACTIVAS
    const challenges = [
      {
        name: 'üî¢ Matem√°ticas R√°pidas',
        type: 'math',
        data: [
          { problem: '5 + 3 = ?', options: ['6', '7', '8', '9'], correct: 2 },
          { problem: '12 - 4 = ?', options: ['7', '8', '9', '10'], correct: 1 },
          { problem: '6 √ó 2 = ?', options: ['10', '11', '12', '13'], correct: 2 },
          { problem: '15 √∑ 3 = ?', options: ['4', '5', '6', '7'], correct: 1 },
          { problem: '9 + 6 = ?', options: ['14', '15', '16', '17'], correct: 1 }
        ]
      },
      {
        name: 'üé® Emojis Iguales',
        type: 'emoji',
        data: [
          { items: ['üöå', 'üöå', 'üöï', 'üöå', 'üöó', 'üöå', 'üöô', 'üöå'], target: 'üöå', count: 4 },
          { items: ['üèñÔ∏è', 'üèùÔ∏è', 'üèñÔ∏è', 'üå¥', 'üèñÔ∏è', 'üåä', 'üèñÔ∏è', 'üèùÔ∏è'], target: 'üèñÔ∏è', count: 4 },
          { items: ['üç§', 'üêô', 'ü¶û', 'üç§', 'ü¶ê', 'üç§', 'üêö', 'üç§'], target: 'üç§', count: 4 },
          { items: ['üé∏', 'üéπ', 'üé∏', 'üé∫', 'üé∏', 'ü•Å', 'üé∏', 'üé∑'], target: 'üé∏', count: 4 }
        ]
      },
      {
        name: 'üìç Encuentra la Diferencia',
        type: 'difference',
        data: [
          { items: ['üî¥', 'üîµ', 'üü¢', 'üü°', 'üî¥', 'üîµ', 'üü¢', '‚≠ê'], target: '‚≠ê', description: 'Encuentra el diferente' },
          { items: ['üçé', 'üçé', 'üçä', 'üçé', 'üçé', 'üçé', 'üçé', 'üçé'], target: 'üçä', description: 'Encuentra el diferente' },
          { items: ['üòÄ', 'üòÄ', 'üòÄ', 'üò¢', 'üòÄ', 'üòÄ', 'üòÄ', 'üòÄ'], target: 'üò¢', description: 'Encuentra el diferente' },
          { items: ['‚≠ê', '‚≠ê', '‚≠ê', 'üí´', '‚≠ê', '‚≠ê', '‚≠ê', '‚≠ê'], target: 'üí´', description: 'Encuentra el diferente' }
        ]
      },
      {
        name: 'üé¨ Ordena la Secuencia',
        type: 'sequence',
        data: [
          { items: ['‚òÄÔ∏è', 'üå§Ô∏è', '‚õÖ', 'üå•Ô∏è', '‚òÅÔ∏è'], correct: [0, 1, 2, 3, 4], description: 'Ordena por claridad del cielo' },
          { items: ['üå±', 'üåø', 'üå≥', 'üå≤', 'üå¥'], correct: [0, 1, 2, 3, 4], description: 'Ordena por tama√±o' },
          { items: ['üë∂', 'üëß', 'üë©', 'üëµ', 'üßì'], correct: [0, 1, 2, 3, 4], description: 'Ordena por edad' },
          { items: ['üêõ', 'üêõ', 'ü¶ã', 'üêõ', 'ü¶ó'], correct: [0, 3, 2, 1, 4], description: 'Ordena por insecto correcto' }
        ]
      },
      {
        name: 'üí° Acertijos Visuales',
        type: 'riddle',
        data: [
          { question: '¬øCu√°ntas ruedas tiene 3 autobuses?', options: ['9', '12', '15', '18'], correct: 3 },
          { question: '¬øSi 1 billete cuesta 2‚Ç¨, cu√°nto cuestan 5?', options: ['8‚Ç¨', '10‚Ç¨', '12‚Ç¨', '15‚Ç¨'], correct: 1 },
          { question: '¬øCu√°ntos lados tiene un tri√°ngulo?', options: ['1', '2', '3', '4'], correct: 2 },
          { question: '¬øQu√© viene primero: el huevo o la gallina?', options: ['Huevo', 'Gallina', 'Ambos', 'Ninguno'], correct: 0 }
        ]
      },
      {
        name: 'üîÑ Memoria de Cartas',
        type: 'memory',
        data: [
          { pairs: [['üöå', 'üöå'], ['üèñÔ∏è', 'üèñÔ∏è'], ['üç§', 'üç§'], ['üé≠', 'üé≠']] },
          { pairs: [['üöó', 'üöó'], ['üè†', 'üè†'], ['üå≥', 'üå≥'], ['üìö', 'üìö']] }
        ]
      }
    ];

    const element = {
      defaultConfig,
      onConfigChange: async (newConfig) => {
        config = { ...defaultConfig, ...newConfig };
        gameState.winsScore = parseInt(config.winning_score) || 15;
      },
      mapToCapabilities: (config) => ({
        recolorables: [
          { get: () => config.primary_color, set: (v) => { config.primary_color = v; window.elementSdk.setConfig({ primary_color: v }); } },
          { get: () => config.secondary_color, set: (v) => { config.secondary_color = v; window.elementSdk.setConfig({ secondary_color: v }); } },
          { get: () => config.accent_color, set: (v) => { config.accent_color = v; window.elementSdk.setConfig({ accent_color: v }); } },
          { get: () => config.button_color, set: (v) => { config.button_color = v; window.elementSdk.setConfig({ button_color: v }); } },
          { get: () => config.text_color, set: (v) => { config.text_color = v; window.elementSdk.setConfig({ text_color: v }); } }
        ],
        borderables: [],
        fontEditable: { get: () => config.font_family, set: (v) => { config.font_family = v; window.elementSdk.setConfig({ font_family: v }); } },
        fontSizeable: { get: () => config.font_size, set: (v) => { config.font_size = v; window.elementSdk.setConfig({ font_size: v }); } }
      }),
      mapToEditPanelValues: (config) => new Map([
        ['game_title', config.game_title],
        ['winning_score', config.winning_score]
      ])
    };

    if (window.elementSdk) window.elementSdk.init(element);

    function selectGameMode(mode) {
      gameState.gameMode = mode;
      document.getElementById('btn-individual').classList.toggle('bg-emerald-50', mode === 'individual');
      document.getElementById('btn-individual').classList.toggle('bg-white', mode !== 'individual');
      document.getElementById('btn-teams').classList.toggle('bg-emerald-50', mode === 'teams');
      document.getElementById('btn-teams').classList.toggle('bg-white', mode !== 'teams');
      selectPlayerCount(2);
    }

    function selectPlayerCount(count) {
      gameState.players = [];
      const container = document.getElementById('players-input');
      container.innerHTML = '';
      
      for (let i = 1; i <= count; i++) {
        const input = document.createElement('input');
        input.type = 'text';
        input.id = `player-name-${i}`;
        input.placeholder = gameState.gameMode === 'teams' ? `Equipo ${i}` : `Jugador ${i}`;
        input.className = 'w-full p-2 border border-gray-300 rounded-lg text-sm';
        container.appendChild(input);
      }
      
      document.querySelectorAll('#player-count-buttons button').forEach(btn => {
        btn.classList.remove('bg-emerald-100', 'border-emerald-300', 'text-emerald-700');
        btn.classList.add('bg-gray-100', 'border-gray-300', 'text-gray-700');
      });
      event.target.classList.remove('bg-gray-100', 'border-gray-300', 'text-gray-700');
      event.target.classList.add('bg-emerald-100', 'border-emerald-300', 'text-emerald-700');
    }

    function startGame() {
      const playerCount = document.getElementById('players-input').children.length;
      gameState.players = [];
      
      for (let i = 1; i <= playerCount; i++) {
        const nameInput = document.getElementById(`player-name-${i}`);
        const name = nameInput.value.trim() || (gameState.gameMode === 'teams' ? `Equipo ${i}` : `Jugador ${i}`);
        gameState.players.push({
          name: name,
          score: 0,
          color: playerColors[(i - 1) % playerColors.length],
          correct: 0
        });
      }
      
      gameState.currentPlayerIndex = 0;
      gameState.winsScore = parseInt(config.winning_score) || 15;
      
      document.getElementById('config-screen').classList.add('hidden');
      document.getElementById('game-screen').classList.remove('hidden');
      
      updatePlayerDisplay();
      renderPlayersPanel();
    }

    function updatePlayerDisplay() {
      const player = gameState.players[gameState.currentPlayerIndex];
      document.getElementById('player-name-display').textContent = player.name;
      document.getElementById('player-color').style.backgroundColor = player.color;
      document.getElementById('player-score-display').textContent = player.score;
    }

    function renderPlayersPanel() {
      const panel = document.getElementById('players-panel');
      panel.innerHTML = '';
      
      gameState.players.forEach((player, index) => {
        const div = document.createElement('div');
        div.className = `p-3 rounded-lg ${index === gameState.currentPlayerIndex ? 'bg-emerald-100 border-2 border-emerald-500' : 'bg-gray-50'} transition-all`;
        div.innerHTML = `
          <div class="flex items-center gap-2 justify-between">
            <div class="flex items-center gap-2">
              <div class="w-4 h-4 rounded-full" style="background-color: ${player.color}"></div>
              <span class="font-semibold text-sm text-gray-800">${player.name}</span>
            </div>
            <span class="title-font font-bold text-lg text-emerald-600">${player.score}</span>
          </div>
          <div class="mt-1 w-full h-2 bg-gray-200 rounded-full overflow-hidden">
            <div class="h-full bg-gradient-to-r from-emerald-400 to-green-500 transition-all" style="width: ${Math.min(100, (player.score / gameState.winsScore) * 100)}%"></div>
          </div>
        `;
        panel.appendChild(div);
      });
    }

    function rollDice() {
      if (gameState.isRolling || gameState.hasRolled || gameState.challengeActive) return;
      
      gameState.isRolling = true;
      document.getElementById('roll-btn').disabled = true;
      
      const dice1 = document.getElementById('dice-1');
      const dice2 = document.getElementById('dice-2');
      
      dice1.classList.add('dice-rolling');
      dice2.classList.add('dice-rolling');
      
      setTimeout(() => {
        gameState.diceResult[0] = Math.floor(Math.random() * 6) + 1;
        gameState.diceResult[1] = Math.floor(Math.random() * 6) + 1;
        const sum = gameState.diceResult[0] + gameState.diceResult[1];
        
        dice1.classList.remove('dice-rolling');
        dice2.classList.remove('dice-rolling');
        
        dice1.textContent = gameState.diceResult[0];
        dice2.textContent = gameState.diceResult[1];
        
        document.getElementById('dice-sum').textContent = `Suma: ${sum}`;
        
        gameState.isRolling = false;
        gameState.hasRolled = true;
        
        setTimeout(() => showChallenge(sum), 500);
      }, 600);
    }

    function showChallenge(points) {
      gameState.challengeActive = true;
      const challenge = challenges[Math.floor(Math.random() * challenges.length)];
      const challengeArea = document.getElementById('challenge-area');
      const contentDiv = document.getElementById('challenge-content');
      
      challengeArea.classList.remove('hidden');
      
      if (challenge.type === 'math' || challenge.type === 'riddle') {
        const item = challenge.data[Math.floor(Math.random() * challenge.data.length)];
        let html = `<p class="text-center text-lg md:text-xl font-semibold text-gray-800 mb-4">${item.problem || item.question}</p>`;
        html += '<div class="grid grid-cols-2 gap-3">';
        item.options.forEach((opt, i) => {
          html += `<button class="p-3 bg-blue-100 hover:bg-blue-200 border-2 border-blue-300 rounded-lg font-bold text-lg transition-all challenge-item" onclick="handleAnswer(${i}, ${item.correct}, ${points})">
            ${opt}
          </button>`;
        });
        html += '</div>';
        contentDiv.innerHTML = html;
      }
      
      else if (challenge.type === 'emoji') {
        const item = challenge.data[Math.floor(Math.random() * challenge.data.length)];
        let html = `<p class="text-center text-sm md:text-base font-semibold text-gray-800 mb-4">Cuenta cu√°ntos ${item.target} hay</p>`;
        html += '<div class="grid grid-cols-4 gap-2 mb-4">';
        item.items.forEach(emoji => {
          html += `<div class="text-3xl md:text-4xl text-center">${emoji}</div>`;
        });
        html += '</div>';
        html += '<div class="grid grid-cols-4 gap-2">';
        for (let i = 1; i <= 4; i++) {
          html += `<button class="p-3 bg-green-100 hover:bg-green-200 border-2 border-green-300 rounded-lg font-bold text-lg transition-all challenge-item" onclick="handleAnswer(${i}, ${item.count}, ${points})">
            ${i}
          </button>`;
        }
        html += '</div>';
        contentDiv.innerHTML = html;
      }
      
      else if (challenge.type === 'difference') {
  const item = challenge.data[Math.floor(Math.random() * challenge.data.length)];
  let html = `<p class="text-center text-sm font-semibold text-gray-800 mb-4">${item.description}</p>`;
  
  html += '<div class="grid grid-cols-4 gap-2">';
  
  item.items.forEach((imageSrc, idx) => {
    html += `
      <button 
        class="p-2 bg-yellow-100 hover:bg-yellow-200 border-2 border-yellow-300 rounded-lg transition-all challenge-item flex items-center justify-center"
        onclick="handleAnswer(${idx}, ${item.items.indexOf(item.target)}, ${points})">
        
        <img src="${imageSrc}" 
             class="w-12 h-12 md:w-16 md:h-16 object-contain pointer-events-none"
             draggable="false">
             
      </button>`;
  });
  
  html += '</div>';
  contentDiv.innerHTML = html;
}

else if (challenge.type === 'sequence') {
  const item = challenge.data[Math.floor(Math.random() * challenge.data.length)];
  let html = `<p class="text-center text-sm font-semibold text-gray-800 mb-4">${item.description}</p>`;
  
  html += '<div id="sequence-container" class="grid grid-cols-5 gap-2 mb-4">';
  
  item.items.forEach((imageSrc, idx) => {
    html += `
      <div 
        class="p-2 bg-purple-100 border-2 border-purple-300 rounded-lg flex items-center justify-center cursor-move transition-all"
        draggable="true"
        ondragstart="dragStart(event, ${idx})"
        ondrop="dragDrop(event)"
        ondragover="allowDrop(event)"
        data-index="${idx}"
        data-correct="${item.correct[idx]}">
        
        <img src="${imageSrc}" 
             class="w-12 h-12 md:w-16 md:h-16 object-contain pointer-events-none"
             draggable="false">
             
      </div>`;
  });
  
  html += '</div>';
  contentDiv.innerHTML = html;
}
      
      else if (challenge.type === 'memory') {
        const item = challenge.data[0];
        const shuffled = shuffleMemory(item.pairs);
        let html = '<div class="grid grid-cols-4 gap-2">';
        shuffled.forEach((pair, idx) => {
          html += `<div class="memory-card" id="card-${idx}" onclick="flipCard(${idx}, '${pair}', ${item.pairs.length * 2}, ${points})">
            <div class="memory-card-inner">
              <div class="memory-card-front">?</div>
              <div class="memory-card-back">${pair}</div>
            </div>
          </div>`;
        });
        html += '</div>';
        contentDiv.innerHTML = html;
      }
    }

    function handleAnswer(selected, correct, points) {
      if (selected === correct) {
        gameState.players[gameState.currentPlayerIndex].score += points;
        gameState.players[gameState.currentPlayerIndex].correct++;
        alert(`¬°Correcto! +${points} puntos`);
      } else {
        alert('Incorrecto');
      }
      nextTurn();
    }

    let flipped = [];
    let matched = 0;

    function flipCard(idx, emoji, total, points) {
      if (flipped.length >= 2) return;
      const card = document.getElementById(`card-${idx}`);
      if (card.classList.contains('flipped')) return;
      
      card.classList.add('flipped');
      flipped.push({ idx, emoji });
      
      if (flipped.length === 2) {
        if (flipped[0].emoji === flipped[1].emoji) {
          matched++;
          flipped = [];
          if (matched === total / 2) {
            gameState.players[gameState.currentPlayerIndex].score += points;
            alert(`¬°Memoria completada! +${points} puntos`);
            nextTurn();
          }
        } else {
          setTimeout(() => {
            document.getElementById(`card-${flipped[0].idx}`).classList.remove('flipped');
            document.getElementById(`card-${flipped[1].idx}`).classList.remove('flipped');
            flipped = [];
          }, 1000);
        }
      }
    }

    function shuffleMemory(pairs) {
      const cards = [...pairs, ...pairs].flat();
      return cards.sort(() => Math.random() - 0.5);
    }

    function dragStart(e, idx) {
      e.dataTransfer.effectAllowed = 'move';
      e.dataTransfer.setData('index', idx);
    }

    function allowDrop(e) {
      e.preventDefault();
    }

    function dragDrop(e) {
      e.preventDefault();
      // Implementar intercambio de posiciones
    }

    function checkSequence(points, correct) {
      alert('Verificaci√≥n completada');
      nextTurn();
    }

    function nextTurn() {
      document.getElementById('challenge-area').classList.add('hidden');
      gameState.challengeActive = false;
      gameState.hasRolled = false;
      gameState.diceResult = [0, 0];
      
      document.getElementById('dice-1').textContent = 'üé≤';
      document.getElementById('dice-2').textContent = 'üé≤';
      document.getElementById('dice-sum').textContent = 'Suma: --';
      document.getElementById('roll-btn').disabled = false;
      
      gameState.currentPlayerIndex = (gameState.currentPlayerIndex + 1) % gameState.players.length;
      
      updatePlayerDisplay();
      renderPlayersPanel();
      
      if (gameState.players[gameState.currentPlayerIndex].score >= gameState.winsScore) {
        showVictory();
      }
    }

    function showVictory() {
      const winner = gameState.players.reduce((a, b) => a.score > b.score ? a : b);
      
      document.getElementById('game-screen').classList.add('hidden');
      document.getElementById('victory-screen').classList.remove('hidden');
      
      document.getElementById('winner-name').textContent = winner.name;
      document.getElementById('winner-score').textContent = `Puntos: ${winner.score}`;
    }

    function backToConfig() {
      document.getElementById('victory-screen').classList.add('hidden');
      document.getElementById('config-screen').classList.remove('hidden');
      gameState = {
        gameMode: 'individual',
        players: [],
        currentPlayerIndex: 0,
        winsScore: 15,
        diceResult: [0, 0],
        isRolling: false,
        hasRolled: false,
        challengeActive: false
      };
      selectGameMode('individual');
    }

    selectGameMode('individual');
  </script>
 <script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'9ce64b6a972bcc6b',t:'MTc3MTE3NDEyNS4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
